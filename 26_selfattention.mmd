flowchart TD
    subgraph 整体流程
        subgraph 输入与词嵌入阶段
            A["输入句子：我爱中国"] --> B["词嵌入操作"]
            B --> B1["'我'词嵌入得到向量：q1 = k1 = v1 = [0.2, 0.3]"]
            B --> B2["'爱'词嵌入得到向量：q2 = k2 = v2 = [0.4, 0.5]"]
            B --> B3["'中国'词嵌入得到向量：q3 = k3 = v3 = [0.6, 0.7]"]
        end
        subgraph 计算注意力得分阶段
            B1 --> C["计算'我'（q1）与其他词（k）的注意力得分"]
            B2 --> D["计算'爱'（q2）与其他词（k）的注意力得分"]
            B3 --> E["计算'中国'（q3）与其他词（k）的注意力得分"]
            C --> C1["score12（'我'与'爱'） = q1 · k2 = 0.2×0.4 + 0.3×0.5 = 0.23"]
            C --> C2["score13（'我'与'中国'） = q1 · k3 = 0.2×0.6 + 0.3×0.7 = 0.33"]
            D --> D1["score21（'爱'与'我'） = q2 · k1 = 0.4×0.2 + 0.5×0.3 = 0.23"]
            D --> D2["score23（'爱'与'中国'） = q2 · k3 = 0.4×0.6 + 0.5×0.7 = 0.59"]
            E --> E1["score31（'中国'与'我'） = q3 · k1 = 0.6×0.2 + 0.7×0.3 = 0.33"]
            E --> E2["score32（'中国'与'爱'） = q3 · k2 = 0.6×0.4 + 0.7×0.5 = 0.59"]
        end
        subgraph 计算注意力权重阶段
            C --> F["计算'我'（q1）的注意力权重"]
            D --> G["计算'爱'（q2）的注意力权重"]
            E --> H["计算'中国'（q2）的注意力权重"]
            F --> F1["sum1 = e^score12 + e^score13 = e^0.23 + e^0.33"]
            F --> F2["α12（'我'与'爱'） = e^score12 / sum1 ≈ 0.433"]
            F --> F3["α13（'我'与'中国'） = e^score13 / sum1 ≈ 0.567"]
            G --> G1["sum2 = e^score21 + e^score23 = e^0.23 + e^0.59"]
            G --> G2["α21（'爱'与'我'） = e^score21 / sum2 ≈ 0.277"]
            G --> G3["α23（'爱'与'中国'） = e^score23 / sum2 ≈ 0.723"]
            H --> H1["sum3 = e^score31 + e^score32 = e^0.33 + e^0.59"]
            H --> H2["α31（'中国'与'我'） = e^score31 / sum3 ≈ 0.352"]
            H --> H3["α32（'中国'与'爱'） = e^score32 / sum3 ≈ 0.648"]
        end
        subgraph 计算上下文向量阶段
            F --> I["计算'我'（q1）的上下文向量"]
            G --> J["计算'爱'（q2）的上下文向量"]
            H --> K["计算'中国'（q3）的上下文向量"]
            I --> I1["context1 = α12 * v2 + α13 * v3"]
            I --> I2[" = 0.433×[0.4, 0.5] + 0.567×[0.6, 0.7]"]
            I --> I3[" = [0.513, 0.623]"]
            J --> J1["context2 = α21 * v1 + α23 * v3"]
            J --> J2[" = 0.277×[0.2, 0.3] + 0.723×[0.6, 0.7]"]
            J --> J3[" = [0.494, 0.594]"]
            K --> K1["context3 = α31 * v1 + α32 * v2"]
            K --> K2[" = 0.352×[0.2, 0.3] + 0.648×[0.4, 0.5]"]
            K --> K3[" = [0.346, 0.446]"]
        end
    end